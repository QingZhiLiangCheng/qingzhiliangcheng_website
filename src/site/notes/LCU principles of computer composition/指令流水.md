---
{"dg-publish":true,"tags":["LCU机组"],"permalink":"/LCU principles of computer composition/指令流水/","dgPassFrontmatter":true,"noteIcon":"","created":"2024-11-28T11:11:14.747+08:00","updated":"2025-04-19T09:58:35.324+08:00"}
---


回顾：提高计算机速度的方法
提高访存速度： 高速芯片  Cache  <font color="#c0504d">多体并行？</font>
提高IO和主机之间的传送速度： 中断 DMA  通道  IO处理机  多总线
提高运算器速度：高速芯片  改进算法  快速进位链
提高处理机处理能力：高速器件   改进系统结构，开发系统的并行性

### 系统的并行性
并行性两种方式：并发和同时
- 并发：两个或者两个以上事件在**同一时间段**发生
- 同时：两个或者两个以上事件在**同一时刻**发生
这里注意两个概念的差异
后面的流水线方式就是同时方式的一种

并行性的等级：
- 可以是过程级：多个程序之间并行执行   ----- 粗粒度   -------软件
- 可以是指令级：可以是不同指令并行解释，，也可以是指令内部的操作之间（比如微操作之间）并行的操作。------- 细粒度 -------- 硬件

### 指令流水的原理
假设只有取值阶段和执行阶段两个阶段
#### 串行执行
![Pasted image 20241215094436.png|400](/img/user/accessory/Pasted%20image%2020241215094436.png)
取指令-----取指令部件
执行指令-----执行指令部件
总有一个部件空闲
#### 指令的二级流水
![Pasted image 20241215094657.png|400](/img/user/accessory/Pasted%20image%2020241215094657.png)
但是并不都是理想状态，指令之间是存在一些相关性的，也不可能满负荷，执行指令和取指令的时间也不会完全重叠
#### 影响指令流水效率加倍的因素
执行时间>取指时间
![Pasted image 20241215095500.png|400](/img/user/accessory/Pasted%20image%2020241215095500.png)
条件转移指令 对指令流水的影响
必须等上一条指令执行完以后，才能确定下一条指令的地址
突然想起CSAPP中的condition control 和 condition move，详见[[CSAPP Computer-System-A-Program-Perspective/Implementing Conditional Branches\|Implementing Conditional Branches]]
解决：分支预测  ……

#### 指令的六级流水
![Pasted image 20241215095915.png|500](/img/user/accessory/Pasted%20image%2020241215095915.png)
六级的功能分别是：取指令-----指令译码-----形成操作数的地址-----取操作数------执行------结果写回
#### 影响指令流水线性能的因素
结构相关：不同指令争用同一功能部件产生资源冲突：比如同一时钟周期，一条指令想使用运算器计算下一条指令的地址  一条指令想进行运算
比如上面那个图中：
![Pasted image 20241215100647.png|500](/img/user/accessory/Pasted%20image%2020241215100647.png)
蓝色的地方：FO要取操作数用到内存  FI要取指令也中到内存 WO写回也用到内存
解决方法：1.停顿  2.指令存储器和数据存储器分开 3.指令预取技术

数据相关：
写后读相关、读后写相关、写后写相关
可能造成：第一次的读还没执行  第二次的写就又写进去了
解决：后推法 旁路技术

控制相关：
转移指令引发的
![Pasted image 20241215101632.png|500](/img/user/accessory/Pasted%20image%2020241215101632.png)
在第三条指令执行结束的时候，才知道发生了转移  中间的指令全都已经进入流水线执行了一部分了

#### 流水线性能
吞吐率：单位时间内流水线所完成指令或输出结果的数量
	最大吞吐率：满负荷运转，无冲突  达到的最大吞吐率
	实际吞吐率
![Pasted image 20241215102133.png|300](/img/user/accessory/Pasted%20image%2020241215102133.png)
最后一个公式：第一条指令流出结果后：每经过$\Delta t$ 就有一个新的结果流出来

加速比：流水线速度和非流水线速度之比
![Pasted image 20241215102542.png|300](/img/user/accessory/Pasted%20image%2020241215102542.png)

效率：各功能那段利用率
流水线有建立时间和排空时间  就是没有完全满负荷的那些时间
![Pasted image 20241215102649.png|400](/img/user/accessory/Pasted%20image%2020241215102649.png)
![Pasted image 20241215102739.png|300](/img/user/accessory/Pasted%20image%2020241215102739.png)
其实就是上面有指令执行的面积和整个虚线的矩形的面积的商

#### 流水线的多发技术
使用多条流水线----超标量技术
![Pasted image 20241215103518.png|400](/img/user/accessory/Pasted%20image%2020241215103518.png)
不用调整指令的执行顺序   编译优化技术可以直接将指令搭配起来

超流水线技术：
一个时钟周期 再分段
![Pasted image 20241215103739.png|400](/img/user/accessory/Pasted%20image%2020241215103739.png)
 在流水线的设计过程中，要加入锁存器，每一个流水段的执行结果在锁存器中进行锁存，作为下一个流水段执行的信号。
 超流水线这种方式：流水段之间是有锁存器的，一个流水段又分成了三分，这三份之间没有锁存器
 所以这种方式的一个特点就是：不同的指令处在同一个流水段当中，相互的信号不能叠加

超长指令字技术
编译程序找到并行性（根据计算机当中部件的数量和种类来确定的）------将多条并行操作指令组合成一条------变成超长指令字
![Pasted image 20241215104659.png|400](/img/user/accessory/Pasted%20image%2020241215104659.png)

#### 流水线结构
指令流水线结构：
![Pasted image 20241215104855.png|400](/img/user/accessory/Pasted%20image%2020241215104855.png)
运算流水线：
![Pasted image 20241215104930.png|400](/img/user/accessory/Pasted%20image%2020241215104930.png)
